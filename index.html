<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:description" content="T·∫°o thi·ªáp 20/10 d·ªÖ d√†ng c√πng B&M. Ch·ªçn m·∫´u, nh·∫≠p l·ªùi ch√∫c v√† t·∫£i v·ªÅ PDF ngay!">
  <title>L√†m thi·ªáp 20/10 c√πng B&M</title>

  <!-- Fonts (h·ªó tr·ª£ ti·∫øng Vi·ªát) -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital@0;1&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

  <!-- html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --primary-color: #c27ba0;
      --secondary-color: #6b9bd6;
      --light-bg: #fff7f9;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body { 
      font-family: Roboto, system-ui, Arial; 
      margin: 0;
      padding: 16px;
      background-color: #f8f8f8;
      color: #333;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .controls {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    h3 {
      margin-top: 0;
      color: var(--primary-color);
      text-align: center;
      font-size: 22px;
    }
    
    label {
      display: block;
      margin: 16px 0 8px;
      font-weight: 600;
      font-size: 15px;
      color: #444;
    }
    
    input, textarea, select { 
      width: 100%; 
      padding: 14px; 
      border-radius: 8px; 
      border: 1px solid #ddd; 
      font-family: inherit;
      font-size: 16px; /* NgƒÉn ch·∫∑n zoom tr√™n iOS */
      background-color: #fff;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    
    input:focus, textarea:focus, select:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 2px rgba(194,123,160,0.2);
    }
    
    textarea { 
      resize: none; 
      min-height: 140px; 
      line-height: 1.5;
    }
    
    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    button { 
      flex: 1;
      padding: 16px; 
      background: var(--primary-color); 
      color: #fff; 
      border: none; 
      border-radius: 8px; 
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 2px 6px rgba(194,123,160,0.3);
    }
    
    button:active {
      transform: translateY(2px);
      box-shadow: 0 1px 3px rgba(194,123,160,0.3);
    }
    
    button.secondary { 
      background: var(--secondary-color);
      box-shadow: 0 2px 6px rgba(107,155,214,0.3);
    }
    
    button.secondary:active {
      box-shadow: 0 1px 3px rgba(107,155,214,0.3);
    }

    /* v√πng preview (m·∫´u thi·ªáp) */
    .preview-wrap { 
      display: flex; 
      align-items: center; 
      justify-content: center;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    #thiep {
      width: 100%;
      max-width: 500px;
      height: 350px;
      padding: 24px;
      box-sizing: border-box;
      border-radius: 12px; 
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      background: linear-gradient(180deg, #fff7f9 0%, #fff 100%);
      border: 6px solid #e89bbc;
      position: relative;
      color: #222;
      overflow: hidden;
      background-image: url('https://c.pxhere.com/photos/08/09/heart_valentine_s_day_love_feeling_happiness_falling_in_love_colorful_heart_darling-675880.jpg!d');
      background-size: cover;
      background-position: center;
    }

    /* N·ªôi dung thi·ªáp */
    .title { 
      font-family: "Noto Serif", serif; 
      font-size: 24px; 
      color: #c27ba0; 
      text-align: center; 
      margin-bottom: 10px;
      font-weight: bold;
    }
    
    .recipient { 
      font-size: 18px; 
      text-align: center; 
      margin-top: 6px; 
      font-weight: 600;
      color: #333;
    }
    
    .lopban { 
      font-size: 16px; 
      text-align: center; 
      color: #555; 
      margin-top: 4px;
    }
    
    .message { 
      margin: 20px auto 0; 
      width: 90%; 
      text-align: center; 
      white-space: pre-wrap; 
      line-height: 1.5; 
      font-size: 16px; 
      color: #111;
      max-height: 140px;
      overflow-y: auto;
    }
    
    .sign { 
      position: absolute; 
      right: 24px; 
      bottom: 20px; 
      font-size: 14px; 
      color: #444;
      font-style: italic;
    }

    /* M·∫´u kh√°c nhau */
    .hong { background: linear-gradient(180deg,#fff7f9 0%, #fff 100%); border-color:#e89bbc; }
    .xanh { background: linear-gradient(180deg,#e6f7ff 0%, #f8feff 100%); border-color:#80bfff; }
    .vang { background: linear-gradient(180deg,#fffbe6 0%, #fffef6 100%); border-color:#d4a017; }

    /* overlay m·ªù khi d√πng ·∫£nh n·ªÅn */
    .overlay {
      position: absolute; 
      inset: 0; 
      background: rgba(255,255,255,0.36); 
      pointer-events: none;
    }

    /* Mobile-first responsive design */
    @media (min-width: 768px) {
      .container {
        flex-direction: row;
        gap: 30px;
        padding: 30px;
      }
      
      .controls {
        width: 320px;
        flex-shrink: 0;
      }
      
      .preview-wrap {
        flex: 1;
      }
      
      #thiep {
        width: 100%;
        max-width: 760px;
        height: 540px;
        padding: 36px;
      }
      
      .title { font-size: 36px; margin-bottom: 14px; }
      .recipient { font-size: 20px; }
      .lopban { font-size: 18px; }
      .message { font-size: 20px; margin-top: 28px; max-height: none; }
      .sign { font-size: 16px; right: 36px; bottom: 28px; }
    }

    @media (max-width: 380px) {
      #thiep {
        height: 320px;
        padding: 20px;
      }
      
      .title { font-size: 22px; }
      .recipient { font-size: 16px; }
      .lopban { font-size: 14px; }
      .message { font-size: 15px; margin-top: 16px; }
      .sign { font-size: 13px; right: 20px; bottom: 16px; }
    }

    /* C·∫£i thi·ªán scrollbar cho message */
    .message::-webkit-scrollbar {
      width: 4px;
    }
    
    .message::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.05);
      border-radius: 10px;
    }
    
    .message::-webkit-scrollbar-thumb {
      background: rgba(194,123,160,0.3);
      border-radius: 10px;
    }
    
    .message::-webkit-scrollbar-thumb:hover {
      background: rgba(194,123,160,0.5);
    }
    
    /* Th√¥ng b√°o */
    .note {
      margin-top: 16px;
      font-size: 14px;
      color: #666;
      text-align: center;
      line-height: 1.4;
    }
    
    /* Loading indicator */
    .loading {
      display: none;
      text-align: center;
      padding: 10px;
      color: var(--primary-color);
    }
    
    .spinner {
      border: 3px solid rgba(194,123,160,0.3);
      border-radius: 50%;
      border-top: 3px solid var(--primary-color);
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      margin: 0 auto 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Ch·ªâ √°p d·ª•ng cho m√†n h√¨nh nh·ªè */
    @media (max-width: 768px) {
      #thiep {
        width: 1500px;    
        height: 500px;   
        max-height: 95vh; 
        margin: 2.5vh auto;
        font-size: 16px;  
      }

      #thiep .message {
        height: auto;       
        overflow: visible; 
        word-wrap: break-word; /* xu·ªëng d√≤ng n·∫øu qu√° d√†i */
      }
    }

  </style>
</head>
<body>
  <div class="container">

    <div class="controls">
      <h3>Thi·∫øt l·∫≠p thi·ªáp</h3>

      <label for="mau" class="text">Ch·ªçn m·∫´u</label>
      <select id="mau" class="input" onchange="updatePreview()"> 
        <option value="hong">üíñ H·ªìng nh·∫π</option>
        <option value="xanh">üíô Xanh pastel</option>
        <option value="vang">üíõ V√†ng t∆∞∆°i</option>
        <option value="tim">üíú T√≠m nh·∫π</option>
        <option value="hong_dao">üåπ H·ªìng ƒë√†o</option>
        <option value="xanh_la">üíö M√†u xanh l√°</option>
      </select>

      <label class="text">Ph√¥ng ch·ªØ</label>
      <select id="text_style" class="input" onchange="updatePreview()">
        <!-- H·ªá th·ªëng c∆° b·∫£n -->
        <option value="Arial">C∆° b·∫£n (Arial)</option>
        <option value="Tahoma">N√©t thanh (Tahoma)</option>
        <option value="Verdana">R√µ r√†ng (Verdana)</option>
        <option value="Helvetica">Hi·ªán ƒë·∫°i (Helvetica)</option>
        <option value="Trebuchet MS">Trang nh√£ (Trebuchet MS)</option>
        
        <!-- Font trang tr·ªçng / c·ªï ƒëi·ªÉn -->
        <option value="Times New Roman">Trang tr·ªçng (Times New Roman)</option>
        <option value="Georgia">Trang nh√£ (Georgia)</option>
        <option value="Palatino Linotype">C·ªï ƒëi·ªÉn (Palatino Linotype)</option>
        <option value="Garamond">Thanh l·ªãch (Garamond)</option>
        <option value="Book Antiqua">C·ªï ƒëi·ªÉn nh·∫π (Book Antiqua)</option>
        
        <!-- Font vui nh·ªôn / th∆∞ ph√°p -->
        <option value="Comic Sans MS">Vui nh·ªôn (Comic Sans MS)</option>
        <option value="Lucida Handwriting">C·∫£m x√∫c (Lucida Handwriting)</option>
        <option value="Lucida Calligraphy">Th∆∞ ph√°p (Lucida Calligraphy)</option>
        <option value="Brush Script MT">Th∆∞ ph√°p (Brush Script MT)</option>
        
        <!-- Google Fonts ph·ªï bi·∫øn, import khi d√πng web -->
        <option value="'Dancing Script', cursive">Ng·ªçt ng√†o (Dancing Script)</option>
        <option value="'Great Vibes', cursive">L√£ng m·∫°n (Great Vibes)</option>
        <option value="'Pacifico', cursive">T∆∞∆°i vui (Pacifico)</option>
        <option value="'Roboto', sans-serif">Hi·ªán ƒë·∫°i (Roboto)</option>
        <option value="'Open Sans', sans-serif">R√µ r√†ng (Open Sans)</option>
        <option value="'Lato', sans-serif">Tinh t·∫ø (Lato)</option>
      </select>

      <label for="can" class="text">CƒÉn l·ªÅ ch·ªØ</label>
      <select id="can" class="input">
        <option value="giua">CƒÉn gi·ªØa</option>
        <option value="trai">CƒÉn tr√°i</option>
        <option value="phai">CƒÉn ph·∫£i</option>
      </select>

      <label for="chonbg" class="text">Ch·ªçn thi·∫øt k·∫ø</label>
      <select id="chonbg" class="input">
        <option value="">‚Äî Ch·ªçn ·∫£nh n·ªÅn ‚Äî</option>
        <option value="·∫¢nh/anh1.jpg">N·ªÅn hoa</option>
        <option value="·∫¢nh/anh2.jpg">N·ªÅn m√πa thu</option>
        <option value="·∫¢nh/anh3.jpg">M√πa xu√¢n</option>
        <option value="·∫¢nh/anh4.jpg">N·ªÅn hoa xu√¢n</option>
        <option value="·∫¢nh/anh5.jpg">N·ªÅn hoa m√πa h·∫°</option>
        <option value="·∫¢nh/anh6.jpg">N·ªÅn vu√¥ng</option>
        <option value="·∫¢nh/anh7.jpg">N·ªÅn hoa t√≠m</option>
        <option value="·∫¢nh/anh8.jpg">V∆∞·ªùn hoa</option>
        <option value="·∫¢nh/anh9.jpg">ƒê√≥a hoa</option>
        <option value="·∫¢nh/anh10.jpg">Ho·∫°t h·ªça</option>
        <option value="·∫¢nh/anh11.webp">ƒê∆°n gi·∫£n</option>
        <option value="·∫¢nh/anh12.webp">B√¥ng h·ªìng</option>
        <option value="·∫¢nh/anh13.webp">D·ªãu d√†ng</option>
        <option value="·∫¢nh/anh14.webp">Nh·∫π nh√†ng</option>
        <option value="·∫¢nh/anh15.jpg">Tinh t·∫ø</option>
      </select>
      <p class="note">Thi·∫øt k·∫ø b·∫°n mu·ªën g·ª≠i ƒë·∫øn b·∫±ng tr√°i tim</p>
      <label for="ten">T√™n ng∆∞·ªùi nh·∫≠n</label>
      <input id="ten" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi nh·∫≠n" class="input">
      <p class="note">Khi t·∫∑ng thi·ªáp, h√£y d√†nh ch√∫t th·ªùi gian k·ªÉ cho ng∆∞·ªùi nh·∫≠n nghe v·ªÅ h√†nh tr√¨nh b·∫°n t·∫°o n√™n t·∫•m thi·ªáp n√†y trong chi·∫øn d·ªãch quy√™n g√≥p s√°ch th·∫Øp s√°ng ∆∞·ªõc m∆° cho tr·∫ª em kh√≥ khƒÉn. H√†nh ƒë·ªông √Ω nghƒ©a t·ª´ t·∫•m l√≤ng.</p>
      <label for="lop" class="text">Nh·∫≠p l·ªõp/t√™n c·ªßa b·∫°n</label>
      <input id="lop" type="text" class="input" placeholder="Nh·∫≠p l·ªõp/t√™n b·∫°n ƒëang h·ªçc (VD: 10D6 ho·∫∑c D6)">

      <label for="content" class="text">L·ªùi ch√∫c</label>
      <textarea id="content" class="input" placeholder="Nh·∫≠p l·ªùi ch√∫c...">C√≥ nh·ªØng ng√†y d√π n·∫Øng hay m∆∞a, nh·ªØng ng√†y ng·ªìi nghe ti·∫øng c√¥ gi·∫£ng, ƒë√≥ l√† m·ªôt trong nh·ªØng k√Ω ·ª©c tu·ªïi h·ªçc tr√≤ th·∫≠t t∆∞∆°i ƒë·∫πp. D∆∞·ªõi m√°i tr∆∞·ªùng th√¢n y√™u, tr√™n con ƒë√≤ c·∫≠p b·∫øn tri th·ª©c, nh√¢n ng√†y 20/10: Con xin ch√∫c c√¥ lu√¥n m·∫°nh kh·ªèe, lu√¥n r·ª±c r·ª° ƒë·ªÉ ti·∫øp t·ª•c c√πng ch√∫ng con ƒëi ƒëi ti·∫øp nh·ªØng qu√£ng ƒë∆∞·ªùng ph√≠a tr∆∞·ªõc ƒë·ªÉ c·∫≠p b·∫øn tri th·ª©c.</textarea>
      <p class="note">N√™n vi·∫øt trong kho·∫£ng 200 ch·ªØ ƒë·ªÉ tr√°nh m·∫•t ch·ªØ.</p>

      <label class="text">G·∫Øn ph·∫ßn cu·ªëi</label>
      <select id="cuoi" class="input" onchange="updatePreview()">
        <option value="1">‚Äî C√πng v·ªõi B&M</option>
        <option value="2">‚Äî T·ª´ t·∫•m l√≤ng</option>
        <option value="3">‚Äî C√πng B&M h√†nh ƒë·ªìng ƒë·∫ßy √Ω nghƒ©a</option>
      </select>

      <label for="bgfile" class="text">Upload ·∫£nh n·ªÅn</label>
      <input id="bgfile" class="input" type="file" accept="image/*">
      <p class="note">T·ª± t·∫£i l√™n thi·∫øt k·∫ø ri√™ng c·ªßa b·∫°n n·∫øu mu·ªën nh√©!</p>
      <div class="button-group">
        <button onclick="updatePreview()">Xem tr∆∞·ªõc</button>
        <button class="secondary" onclick="exportPDF()">T·∫£i PDF</button>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>ƒêang t·∫°o thi·ªáp...</div>
      </div>

      <p class="note">Nhanh h∆°n v·ªõi Book and Media</p>
      <p class="note">
        T·∫£i ·∫£nh l√™n ƒë·ªÉ l√†m thi·ªáp nh√©! ·ª®ng d·ª•ng ho·∫°t ƒë·ªông t·ªët nh·∫•t tr√™n tr√¨nh duy·ªát Chrome v√† Safari.
      </p>
    </div>
    <div class="">
          <p class="note">ƒê·ª´ng lo, thi·ªáp preview to th·∫ø l√† t√≠nh nƒÉng xu·∫•t PDF si√™u ƒë·∫πp th√¥i üòé Kh√¥ng ph·∫£i l·ªói ƒë√¢u!</p>
      <div id="thiep" class="mauvien">
        <div class="title" id="color-title">L·ªùi ch√∫c y√™u th∆∞∆°ng 20-10</div>
        <div id="lopban" class="lopban"></div>
        <div id="recipient" class="recipient"></div>
        <div id="message" class="message"></div>
        <div class="sign" id="signText">‚Äî T·ª´ t·∫•m l√≤ng</div>
        <div class="overlay"></div>
      </div>
    </div>
  </div>

<script>
  // === Element references ===
  const elThiep      = document.getElementById('thiep');
  const selectMau    = document.getElementById('mau');
  const bgSelect     = document.getElementById('chonbg');
  const cantext      = document.getElementById('can');
  const tenInput     = document.getElementById('ten');
  const lopInput     = document.getElementById('lop');
  const contentInput = document.getElementById('content');
  const recipientEl  = document.getElementById('recipient');
  const lopbanEl     = document.getElementById('lopban');
  const messageEl    = document.getElementById('message');
  const bgFileInput  = document.getElementById('bgfile');
  const btnExport    = document.querySelector('button.secondary');
  const loadingEl    = document.getElementById('loading');
  const phancuoiEl   = document.getElementById('cuoi');
  const signEl       = document.getElementById('signText');
  const color_titleEl = document.getElementById('color-title');
  const text_styleEl = document.getElementById('text_style');

  // === Fix mobie UI PDF ===
  if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
    // Code ch·ªâ ch·∫°y tr√™n ƒëi·ªán tho·∫°i
    function exportPDFMobile() {
      updatePreview();
      loadingEl.style.display = 'block';

      const opt = {
        margin: [30, 0],
        filename: `B&M_su_kien_20_thang_10_${tenInput.value.trim() || 'Thiep'}.pdf`,
        image: { type: 'jpeg', quality: 0.95 },
        html2canvas: { scale: 2, useCORS: true, backgroundColor: null },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      const thiepClone = elThiep.cloneNode(true);
      thiepClone.style.boxShadow = 'none';
      thiepClone.style.transform = 'none';
      const width = 5000;   // px
      const height = 5130; // px
      thiepClone.style.width = elThiep.offsetWidth + 'px';
      thiepClone.style.height = elThiep.offsetHeight + 'px';

      const tempDiv = document.createElement('div');
      tempDiv.style.position = 'fixed';
      tempDiv.style.left = '-9999px';
      tempDiv.appendChild(thiepClone);
      document.body.appendChild(tempDiv);

      html2pdf()
        .set(opt)
        .from(thiepClone)
        .save()
        .then(() => {
          document.body.removeChild(tempDiv);
          loadingEl.style.display = 'none';
        })
        .catch(err => {
          console.error('L·ªói PDF (mobile):', err);
          loadingEl.style.display = 'none';
        });
    }

    // G√°n v√†o n√∫t ri√™ng ho·∫∑c g·ªçi tr·ª±c ti·∫øp:
    // document.getElementById("btnMobileExport").onclick = exportPDFMobile;
  }

  // === Event listeners ===
  selectMau.addEventListener('change', updatePreview);
  cantext.addEventListener('change', updatePreview);
  bgSelect.addEventListener('change', updatePreview);
  bgFileInput.addEventListener('change', handleUploadBG);
  btnExport.addEventListener('click', exportPDF);

  // T·ª± ƒë·ªông c·∫≠p nh·∫≠t preview khi ng∆∞·ªùi d√πng nh·∫≠p
  tenInput.addEventListener('input', updatePreview);
  lopInput.addEventListener('input', updatePreview);
  contentInput.addEventListener('input', updatePreview);

  // === Update preview based on controls ===
  function updatePreview() {
    // 1. M√†u m·∫´u
    elThiep.classList.remove('hong', 'xanh', 'vang');
    elThiep.classList.add(selectMau.value);

    const colorValue = selectMau.value;

    if (colorValue === 'hong') {
      elThiep.style.borderColor = '#e89bbc';
      color_titleEl.style.color = '#c27ba0';
    } else if (colorValue === 'xanh') {
      elThiep.style.borderColor = '#80bfff';
      color_titleEl.style.color = '#6b9bd6';
    } else if (colorValue === 'vang') {
      elThiep.style.borderColor = '#d4a017';
      color_titleEl.style.color = '#d4a017';
    } else if (colorValue === 'tim') {
      elThiep.style.borderColor = '#b366ff';
      color_titleEl.style.color = '#b366ff';
    } else if (colorValue === 'hong_dao') {
      elThiep.style.borderColor = '#ff9999';
      color_titleEl.style.color = '#ff6666';
    } else if (colorValue === 'xanh_la') {
      elThiep.style.borderColor = '#cce5cc';
      color_titleEl.style.color = '#99cc99';
    }

    // 2. ·∫¢nh n·ªÅn t·ª´ gallery
    if (bgSelect.value) {
      elThiep.style.backgroundImage    = `url(${bgSelect.value})`;
      elThiep.style.backgroundSize     = 'cover';
      elThiep.style.backgroundPosition = 'center';
      document.querySelector('#thiep .overlay').style.background =
        'rgba(255,255,255,0.36)';
    }

    // 3. CƒÉn l·ªÅ ch·ªØ
    const alignMap = { giua: 'center', trai: 'left', phai: 'right' };
    messageEl.style.textAlign =
      alignMap[cantext.value] || 'center';

    // 4. N·ªôi dung vƒÉn b·∫£n
    const ten = tenInput.value.trim()     || 'C√¥ Th√¢n M·∫øn';
    const msg = contentInput.value.trim() || 'Ch√∫c c√¥ m·ªçi ƒëi·ªÅu t·ªët ƒë·∫πp.';
    const lop = lopInput.value.trim()     || '10D6 th√¢n y√™u.';

    recipientEl.textContent = `G·ª≠i ${ten},`;
    messageEl.textContent   = msg;
    lopbanEl.textContent    = `G·ª≠i t·ª´ ${lop}`;

    // 5. In cu·ªëi
    const cuoiValue = phancuoiEl.value;
    let signText = '';
    if (cuoiValue === '1') {
      signText = '‚Äî C√πng B&M, g·ª≠i ch√∫t y√™u th∆∞∆°ng ch√¢n th√†nh';
      signEl.textContent = signText;
    } else if (cuoiValue === '2') {
      signText = '‚Äî T·ª´ t·∫•m l√≤ng';
      signEl.textContent = signText;
    } else if (cuoiValue === '3') {
      signText = '‚Äî C√πng B&M h√†nh ƒë·ªìng ƒë·∫ßy √Ω nghƒ©a';
      signEl.textContent = signText;
    }

    // 6. Ph√¥ng ch·ªØ t√πy ch·ªânh cho n·ªôi dung v√† ti√™u ƒë·ªÅ
    const selectedFont = text_styleEl.value;
    if (selectedFont) {
      messageEl.style.fontFamily = selectedFont;
      color_titleEl.style.fontFamily = selectedFont;
    } else {
      messageEl.style.fontFamily = '';
      color_titleEl.style.fontFamily = '';
    }
  }

  // === X·ª≠ l√Ω upload ·∫£nh t√πy ch·ªânh ===
  function handleUploadBG(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    // Hi·ªÉn th·ªã loading
    loadingEl.style.display = 'block';
    
    const reader = new FileReader();
    reader.onload = function(e) {
      const url = e.target.result;
      elThiep.style.backgroundImage    = `url(${url})`;
      elThiep.style.backgroundSize     = 'cover';
      elThiep.style.backgroundPosition = 'center';
      document.querySelector('#thiep .overlay').style.background =
        'rgba(255,255,255,0.36)';
      
      // ·∫®n loading
      loadingEl.style.display = 'none';
    };
    reader.readAsDataURL(file);
  }

  // === Xu·∫•t PDF v·ªõi html2pdf.js ===
  function exportPDF() {
    updatePreview();
    
    // Hi·ªÉn th·ªã loading
    loadingEl.style.display = 'block';
    
    // C·∫•u h√¨nh t·ªëi ∆∞u cho xu·∫•t PDF
    const opt = {
      margin: [50, 0],
      filename: `B&M_su_kien_20_thang_10_${tenInput.value.trim() || 'Thiep'}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { 
        scale: 2, 
        useCORS: true,
        logging: false,
        backgroundColor: null
      },
      jsPDF: { 
        unit: 'mm',          //  D√πng ƒë∆°n v·ªã mm ƒë·ªÉ kh·ªõp v·ªõi A4
        format: 'a4',        //  Xu·∫•t ƒë√∫ng kh·ªï gi·∫•y A4
        orientation: 'portrait'
      }
    };

    // T·∫°o b·∫£n sao c·ªßa thi·ªáp ƒë·ªÉ tr√°nh ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªÉn th·ªã
    const thiepClone = elThiep.cloneNode(true);
    thiepClone.style.boxShadow = 'none';
    thiepClone.style.transform = 'none';
    thiepClone.style.position = 'relative';
    thiepClone.style.width = elThiep.offsetWidth + 'px';
    thiepClone.style.height = elThiep.offsetHeight + 'px';

    // Th√™m cƒÉn gi·ªØa thi·ªáp trong trang PDF
    thiepClone.style.display = 'block';
    thiepClone.style.margin = '0 auto'; // cƒÉn gi·ªØa ngang
    thiepClone.style.padding = '50px 0'; // th√™m ch√∫t kho·∫£ng c√°ch tr√™n d∆∞·ªõi

    // T·∫°o m·ªôt div t·∫°m th·ªùi ƒë·ªÉ ch·ª©a b·∫£n sao
    const tempDiv = document.createElement('div');
    tempDiv.style.position = 'fixed';
    tempDiv.style.left = '-9999px';
    tempDiv.appendChild(thiepClone);
    document.body.appendChild(tempDiv);
    
    // Xu·∫•t PDF t·ª´ b·∫£n sao
    html2pdf().set(opt).from(thiepClone).save().then(() => {
      // D·ªçn d·∫πp sau khi xu·∫•t
      document.body.removeChild(tempDiv);
      loadingEl.style.display = 'none';
    }).catch(err => {
      console.error('L·ªói khi t·∫°o PDF:', err);
      loadingEl.style.display = 'none';
      alert('ƒê√£ c√≥ l·ªói khi t·∫£i PDF. H√£y ki·ªÉm tra quy·ªÅn t·∫£i xu·ªëng tr√™n tr√¨nh duy·ªát ho·∫∑c li√™n h·ªá v·ªõi qu·∫£n tr·ªã vi√™n.');
    });
  }

  // === Kh·ªüi t·∫°o preview l·∫ßn ƒë·∫ßu ===
  updatePreview();
</script>
</body>
</html>